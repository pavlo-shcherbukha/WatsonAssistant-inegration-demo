# Предназанчен для развертывения проекта в OpenShift 4

## Перечень того, что включает развертывание

- настройка локальных переменных, специфичных для среды проетка
- создание проетка комаднами OC
- Создание секретов для подключения к GIT
- Деплоймент контейнеров (пока праямос github)
- Деплоймент бизнеслогики с PVX-GILAB



## Назначение файлов

- prj_env.cmd
Содержит настройку на проект и настройку на логин в openshift. Принимает параметры среды [dev, int, prod]

- del_prj_opshift.cmd  
Выполняет удаление проекта и всех его приложений

- crt_prj_opshift.cmd 
Выполняет пакетоное создание проекта и всех  секретов. Приложения создаются в отдельном файле.

- grn_prj_opshift.cmd 
Дать права на проект другим разработчикам

- rev_prj_opshift.cmd
забрать права на проект

- crt_prj_secret.cmd 
Создать сикреты внутри проекта

- crt_app.cmd - создание всех приложений проекта

Ниже скрипты на создание каждого отдельного приложения и его роутера-если нужно
    - crt_app_couchdb.cmd       
    Создание из контейнера  образа БД
    - crt_app_mvru-plus-be.cmd
    Создание из GIT непосредственно бакнтда 
    - crt_app_mvru-plus-begw.cmd
    Создание из GIT  API-Gateway.


- в файлах *.env хранятся настройки переменных окружения.

    - как решить пробелму зависимых env-переменных - загадка, но кажется используем отложенный deployemnt


## Connect to Openshift UI

[WEB UI](https://your-domain:8443/console)

## Connect to OpenShift CLI oc

https://tst-okd-cluster.your-domain:8443 

## Пояснения к ключам на примере 

```bash
    echo ****************************************
    echo *    create mapp
    echo * 
    echo ****************************************
rem --output=yaml --labels=":latest"
    - удаление приложения
    
    oc delete all -l app=mapp
    - создание приложения из гитовго репозитория 
    
    oc new-app  http://***.git#tz_000001 --context-dir=/mapp  --name="mapp" --env-file ./mapp.env --strategy=source --source-secret=sinc-gitlab-pvx-1 
    --image-stream=openshift/nodejs
    

    /** пояснения */
    
    - указание git репозитория http://*****.git#tz_000001

    - указание branch #tz_000001

    - указание определеного каталога в репозитории --context-dir=/mapp

    - указание имени прложения и имени исходящего образа: --name="mapp"

    - Указание файла с настройками env-переменных: --env-file ./mapp.env

    - Жестко фиксируем, что строим из source code --strategy=source 

    - Указываем, какой образ использовать для построения приложения: --image-stream=openshift/nodejs

    - Указание секрета, который используется для доступа к репозиторию --source-secret=sinc-gitlab-pvx-1

```

Пока BUILD выполняется вручную чере интефейс или командами oc

